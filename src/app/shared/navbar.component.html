<nav class="border-bottom sticky-top bg-body">
    <div class="container d-flex align-items-center justify-content-between py-2">
        <a class="navbar-brand fw-semibold text-decoration-none d-flex align-items-center gap-2" routerLink="/">
            <i class="bi bi-briefcase"></i>
            <span>
                {{ ('app.title' | translate) === 'app.title' ? 'Employee Portal' : ('app.title' | translate) }}
            </span>
        </a>

        <!-- Mobile toggler -->
        <button class="btn btn-outline-secondary d-lg-none" type="button" (click)="mobileOpen = !mobileOpen"
            aria-label="Toggle menu">
            <i class="bi" [class.bi-x-lg]="mobileOpen" [class.bi-list]="!mobileOpen"></i>
        </button>

        <!-- Desktop menu -->
        <div class="d-none d-lg-flex align-items-center gap-3">
            <a class="nav-link px-2" routerLink="/employees" routerLinkActive="active">
                <i class="bi bi-people-fill me-1"></i>
                {{ ('nav.employees' | translate) === 'nav.employees' ? 'Employees' : ('nav.employees' | translate) }}
            </a>
            <a class="nav-link px-2" routerLink="/medical" routerLinkActive="active">
                <i class="bi bi-heart-pulse me-1"></i>
                {{ ('nav.medical' | translate) === 'nav.medical' ? 'Medical' : ('nav.medical' | translate) }}
            </a>
            <a class="nav-link px-2" routerLink="/charts" routerLinkActive="active">
                <i class="bi bi-graph-up me-1"></i>
                {{ ('nav.charts' | translate) === 'nav.charts' ? 'Charts' : ('nav.charts' | translate) }}
            </a>

            <!-- Settings -->
            <div class="dropdown" [class.show]="settingsOpen">
                <button #settingsBtn class="btn btn-outline-secondary d-flex align-items-center gap-2"
                    (click)="toggleSettings($event)">
                    <i class="bi bi-gear"></i>
                    <span>{{ ('nav.settings' | translate) === 'nav.settings' ? 'Settings' : ('nav.settings' | translate)
                        }}</span>
                    <i class="bi bi-caret-down-fill small"></i>
                </button>
                <div #settingsMenu class="dropdown-menu dropdown-menu-end p-3 shadow rounded-3"
                    [class.show]="settingsOpen" style="min-width: 260px;">

                    <div class="mb-2 fw-semibold">
                        {{ ('settings.title' | translate) === 'settings.title' ? 'Quick Settings' : ('settings.title' |
                        translate) }}
                    </div>

                    <!-- Theme -->
                    <div class="form-check form-switch">
                        <input id="navTheme" class="form-check-input" type="checkbox" [checked]="isDark()"
                            (change)="onThemeToggle($event)">
                        <label class="form-check-label" for="navTheme">
                            {{
                            isDark()
                            ? (('settings.dark' | translate) === 'settings.dark' ? 'Dark theme' : ('settings.dark' |
                            translate))
                            : (('settings.light' | translate) === 'settings.light' ? 'Light theme' : ('settings.light' |
                            translate))
                            }}
                        </label>
                    </div>

                    <!-- Language -->
                    <div class="mt-3">
                        <label class="form-label mb-1">
                            {{ ('settings.language' | translate) === 'settings.language' ? 'Language' :
                            ('settings.language' | translate) }}
                        </label>
                        <select class="form-select form-select-sm" [value]="lang" (change)="onLangChange($event)">
                            <option value="en">English</option>
                            <option value="hi">हिन्दी</option>
                        </select>
                    </div>

                    <!-- Notifications -->
                    <div class="mt-3 border-top pt-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-semibold mb-1">
                                    {{ ('settings.notifications' | translate) === 'settings.notifications' ?
                                    'Notifications' : ('settings.notifications' | translate) }}
                                </div>
                                <div class="text-muted small">
                                    {{ ('settings.hrAlerts' | translate) === 'settings.hrAlerts' ? 'Enable HR alerts' :
                                    ('settings.hrAlerts' | translate) }}
                                </div>
                            </div>
                            <div class="form-check form-switch m-0">
                                <input id="hrNotif" class="form-check-input" type="checkbox" [checked]="hrNotif"
                                    (change)="onHrToggle($event)">
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary mt-2"
                            (click)="testNotification()">
                            <i class="bi bi-bell me-1"></i>
                            {{ ('settings.testNotification' | translate) === 'settings.testNotification' ? 'Send test' :
                            ('settings.testNotification' | translate) }}
                        </button>
                    </div>

                </div>
            </div>

            <!-- Account (Login/Logout) -->
            <ng-container *ngIf="(auth.isLoggedIn$ | async); else loginBtn">
                <div class="dropdown" [class.show]="accountOpen">
                    <button #accountBtn class="btn btn-outline-primary d-flex align-items-center gap-2"
                        (click)="toggleAccount($event)">
                        <i class="bi bi-person-circle"></i>
                        <span>{{ auth.currentUser?.name || 'Account' }}</span>
                        <i class="bi bi-caret-down-fill small"></i>
                    </button>
                    <div #accountMenu class="dropdown-menu dropdown-menu-end p-2 shadow rounded-3"
                        [class.show]="accountOpen" style="min-width: 180px;">
                        <button class="dropdown-item d-flex align-items-center gap-2" (click)="logout()">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </button>
                    </div>
                </div>
            </ng-container>
            <ng-template #loginBtn>
                <a class="btn btn-outline-primary" routerLink="/login">
                    <i class="bi bi-box-arrow-in-right me-1"></i> Login
                </a>
            </ng-template>
        </div>
    </div>

    <!-- Mobile menu -->
    <div *ngIf="mobileOpen" class="border-top bg-body d-lg-none">
        <div class="container py-2 d-flex flex-column gap-2">
            <a class="nav-link px-0" routerLink="/employees" (click)="closeMobile()">
                <i class="bi bi-people-fill me-2"></i>
                {{ ('nav.employees' | translate) === 'nav.employees' ? 'Employees' : ('nav.employees' | translate) }}
            </a>
            <a class="nav-link px-0" routerLink="/medical" (click)="closeMobile()">
                <i class="bi bi-heart-pulse me-2"></i>
                {{ ('nav.medical' | translate) === 'nav.medical' ? 'Medical' : ('nav.medical' | translate) }}
            </a>
            <a class="nav-link px-0" routerLink="/charts" (click)="closeMobile()">
                <i class="bi bi-graph-up me-2"></i>
                {{ ('nav.charts' | translate) === 'nav.charts' ? 'Charts' : ('nav.charts' | translate) }}
            </a>

            <a *ngIf="!(auth.isLoggedIn$ | async)" class="btn btn-outline-primary mt-2" routerLink="/login"
                (click)="closeMobile()">
                <i class="bi bi-box-arrow-in-right me-1"></i> Login
            </a>
            <button *ngIf="(auth.isLoggedIn$ | async)" class="btn btn-outline-danger mt-2" (click)="logout()">
                <i class="bi bi-box-arrow-right me-1"></i> Logout
            </button>
        </div>
    </div>
</nav>